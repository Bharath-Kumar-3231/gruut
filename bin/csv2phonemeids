#!/usr/bin/env bash
set -e

lang="$1"
csv="$2"

if [[ -z "${csv}" ]]; then
    echo 'Usage: csv2phonemeids <LANG> <CSV>' >&2
    exit 1
fi

if [[ -n "$(which gruut)" ]]; then
    gruut='gruut'
else
    this_dir="$( cd "$( dirname "$0" )" && pwd )"
    gruut="${this_dir}/gruut"
fi

"${gruut}" "${lang}" tokenize < <(cut -d'|' -f2- "${csv}") | \
    "${gruut}" "${lang}" phonemize --read-all --word-breaks | \
    "${gruut}" "${lang}" phonemes2ids | \
    jq -r '@sh' | \
    paste -d'|' <(cut -d'|' -f1 "${csv}") -
